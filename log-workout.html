<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Log Workout</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <style>
        body {
            max-width: 900px;
            margin: 0 auto;
        }
        .exercise-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem;
            background: var(--pico-card-background-color);
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .exercise-item input[type="checkbox"] {
            margin: 0;
        }
        .exercise-info {
            flex: 1;
        }
        .exercise-name {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        .exercise-meta {
            font-size: 0.875rem;
            color: var(--pico-muted-color);
        }
        nav {
            margin-bottom: 2rem;
        }
        nav a {
            margin-right: 1rem;
        }
    </style>
</head>
<body>
    <main class="container">
        <nav>
            <a href="/">Exercise Library</a>
            <a href="/log-workout/"><strong>Log Workout</strong></a>
        </nav>

        <h1>ðŸ’ª Log Today's Workout</h1>
        
        <article>
            <header>
                <h2 id="today-date">Loading...</h2>
            </header>
            
            <form id="workout-form">
                <div id="exercises-list">
                    <!-- Exercises will be loaded here -->
                </div>
                
                <label>
                    Workout Notes
                    <textarea id="workout-notes" placeholder="How did it feel? Any PRs? Observations?"></textarea>
                </label>
                
                <button type="submit">Save Workout</button>
            </form>
        </article>

        <h2>Recent Workouts</h2>
        <div id="workout-history">
            <p><em>No workouts logged yet. Complete the form above to get started!</em></p>
        </div>
    </main>

    <script>
        // Display today's date
        const today = new Date();
        const dateStr = today.toLocaleDateString('en-US', { 
            weekday: 'long', 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        });
        document.getElementById('today-date').textContent = dateStr;

{% set sortedExercises = collections.exercises | sort(false, false, 'data.name') %}

const exercises = [
    {% for exercise in sortedExercises %}
    {
        name: "{{ exercise.data.name }}",
        equipment: "{{ exercise.data.equipment }}",
        sets: {{ exercise.data.sets | default(3) }},
        reps: "{{ exercise.data.reps | default('10') }}"
    }{% if not loop.last %},{% endif %}
    {% endfor %}
];
        // Load exercises into form
        const exercisesList = document.getElementById('exercises-list');
        exercises.forEach((exercise, index) => {
            const div = document.createElement('div');
            div.className = 'exercise-item';
            div.innerHTML = `
                <input type="checkbox" id="ex-${index}" name="exercise" value="${exercise.name}">
                <div class="exercise-info">
                    <div class="exercise-name">${exercise.name}</div>
                    <div class="exercise-meta">
                        ${exercise.sets} sets Ã— ${exercise.reps} reps
                    </div>
                </div>
            `;
            exercisesList.appendChild(div);
        });

        // Load and display workout history
        function loadWorkoutHistory() {
            const workouts = JSON.parse(localStorage.getItem('workouts') || '[]');
            const historyDiv = document.getElementById('workout-history');
            
            if (workouts.length === 0) {
                historyDiv.innerHTML = '<p><em>No workouts logged yet.</em></p>';
                return;
            }

            historyDiv.innerHTML = workouts.slice(0, 5).map(workout => {
                const date = new Date(workout.date).toLocaleDateString('en-US', { 
                    month: 'short', 
                    day: 'numeric',
                    year: 'numeric'
                });
                return `
                    <article>
                        <header>
                            <strong>${date}</strong>
                        </header>
                        <p><strong>Completed:</strong> ${workout.exercises.join(', ') || 'None'}</p>
                        ${workout.notes ? `<p><em>${workout.notes}</em></p>` : ''}
                    </article>
                `;
            }).join('');
        }

        // Handle form submission
        document.getElementById('workout-form').addEventListener('submit', (e) => {
            e.preventDefault();
            
            // Get checked exercises
            const checkedBoxes = document.querySelectorAll('input[name="exercise"]:checked');
            const completedExercises = Array.from(checkedBoxes).map(cb => cb.value);
            
            // Get notes
            const notes = document.getElementById('workout-notes').value;
            
            // Create workout object
            const workout = {
                date: new Date().toISOString(),
                exercises: completedExercises,
                notes: notes
            };
            
            // Save to localStorage
            const workouts = JSON.parse(localStorage.getItem('workouts') || '[]');
            workouts.unshift(workout); // Add to beginning
            localStorage.setItem('workouts', JSON.stringify(workouts));
            
            // Show success message
            alert('Workout saved! ðŸŽ‰');
            
            // Reset form
            e.target.reset();
            
            // Reload history
            loadWorkoutHistory();
        });

        // Load history on page load
        loadWorkoutHistory();
    </script>
</body>
</html>
