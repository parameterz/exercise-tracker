<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>6-Month Workout Tracker (Google Sheets)</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // ============= CONFIGURATION =============
        // TODO: Replace these with your actual values!
        const SHEETS_CONFIG = {
            apiKey: 'AIzaSyCACDoI6Jwz2go40D7qjgUuPN2QYiAjd6I',
            spreadsheetId: '1l_yBeNv1MDUsYa2VyMSEOJIBi-GSocOQ6x3XdWiGH5Q',
        };

        // ============= INLINE SVG ICONS =============
        const Check = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
        );

        const ChevronDown = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
        );

        const ChevronUp = ({ size = 24 }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <polyline points="18 15 12 9 6 15"></polyline>
            </svg>
        );

        // ============= GOOGLE SHEETS API =============
        class SheetsAPI {
            constructor(config) {
                this.apiKey = config.apiKey;
                this.spreadsheetId = config.spreadsheetId;
                this.baseUrl = 'https://sheets.googleapis.com/v4/spreadsheets';
            }

            async read(range) {
                const url = `${this.baseUrl}/${this.spreadsheetId}/values/${range}?key=${this.apiKey}`;
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                const data = await response.json();
                return data.values || [];
            }

            async append(range, values) {
                const url = `${this.baseUrl}/${this.spreadsheetId}/values/${range}:append?valueInputOption=USER_ENTERED&key=${this.apiKey}`;
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ values })
                });
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return response.json();
            }

            async update(range, values) {
                const url = `${this.baseUrl}/${this.spreadsheetId}/values/${range}?valueInputOption=USER_ENTERED&key=${this.apiKey}`;
                const response = await fetch(url, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ values })
                });
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return response.json();
            }
        }

        // ============= MAIN APP =============
        function ExerciseTracker() {
            const [api, setApi] = useState(null);
            const [loading, setLoading] = useState(true);
            const [saving, setSaving] = useState(false);
            const [lastSync, setLastSync] = useState(null);
            
            // State
            const [currentWeek, setCurrentWeek] = useState(1);
            const [completedWorkouts, setCompletedWorkouts] = useState({});
            const [weightLog, setWeightLog] = useState({});
            const [dailyWeights, setDailyWeights] = useState({});
            const [weekNotes, setWeekNotes] = useState({});
            
            // UI State
            const [expandedPhase, setExpandedPhase] = useState(1);
            const [expandedWeek, setExpandedWeek] = useState({});
            const [expandedDay, setExpandedDay] = useState({});
            const [showWeightModal, setShowWeightModal] = useState(false);
            const [tempWeight, setTempWeight] = useState('');
            const [selectedWeek, setSelectedWeek] = useState(1);
            const [todayWeight, setTodayWeight] = useState('');

            // ============= DATA LOADING =============
            useEffect(() => {
                loadData();
            }, []);

            async function loadData() {
                try {
                    const sheetsApi = new SheetsAPI(SHEETS_CONFIG);
                    setApi(sheetsApi);

                    // Load all data
                    const [workouts, weights, daily, notes] = await Promise.all([
                        sheetsApi.read('workouts!A2:D'),
                        sheetsApi.read('weight_log!A2:C'),
                        sheetsApi.read('daily_weights!A2:C'),
                        sheetsApi.read('week_notes!A2:B')
                    ]);

                    // Parse workouts
                    const workoutMap = {};
                    workouts.forEach(([week, day, exercise, completed]) => {
                        const key = `w${week}-d${day}-e${exercise}`;
                        workoutMap[key] = completed === 'TRUE';
                    });

                    // Parse weight log
                    const weightMap = {};
                    weights.forEach(([date, week, weight]) => {
                        weightMap[week] = parseFloat(weight);
                    });

                    // Parse daily weights
                    const dailyMap = {};
                    daily.forEach(([date, weight]) => {
                        dailyMap[date] = parseFloat(weight);
                    });

                    // Parse notes
                    const notesMap = {};
                    notes.forEach(([week, note]) => {
                        notesMap[week] = note;
                    });

                    setCompletedWorkouts(workoutMap);
                    setWeightLog(weightMap);
                    setDailyWeights(dailyMap);
                    setWeekNotes(notesMap);
                    setLastSync(new Date());
                    setLoading(false);

                } catch (error) {
                    console.error('Load error:', error);
                    alert('Failed to load data. Check your API key and spreadsheet ID.');
                    setLoading(false);
                }
            }

            // ============= SAVE FUNCTIONS =============
            async function toggleWorkout(week, dayId, exerciseId) {
                const key = `w${week}-d${dayId}-e${exerciseId}`;
                const newValue = !completedWorkouts[key];
                
                // Optimistic update
                setCompletedWorkouts(prev => ({ ...prev, [key]: newValue }));
                
                try {
                    setSaving(true);
                    await api.append('workouts!A:D', [[week, dayId, exerciseId, newValue ? 'TRUE' : 'FALSE']]);
                    setLastSync(new Date());
                } catch (error) {
                    console.error('Save error:', error);
                    setCompletedWorkouts(prev => ({ ...prev, [key]: !newValue }));
                    alert('Failed to save. Please try again.');
                } finally {
                    setSaving(false);
                }
            }

            async function saveWeightForWeek() {
                if (!tempWeight || !selectedWeek) return;
                
                const today = new Date().toISOString().split('T')[0];
                const weight = parseFloat(tempWeight);
                
                try {
                    setSaving(true);
                    await api.append('weight_log!A:C', [[today, selectedWeek, weight]]);
                    setWeightLog(prev => ({ ...prev, [selectedWeek]: weight }));
                    setShowWeightModal(false);
                    setTempWeight('');
                    setLastSync(new Date());
                } catch (error) {
                    alert('Failed to save weight.');
                } finally {
                    setSaving(false);
                }
            }

            async function saveDailyWeight() {
                if (!todayWeight) return;
                
                const today = new Date().toISOString().split('T')[0];
                const weight = parseFloat(todayWeight);
                
                try {
                    setSaving(true);
                    await api.append('daily_weights!A:C', [[today, weight, '']]);
                    setDailyWeights(prev => ({ ...prev, [today]: weight }));
                    setTodayWeight('');
                    setLastSync(new Date());
                } catch (error) {
                    alert('Failed to save daily weight.');
                } finally {
                    setSaving(false);
                }
            }

            async function saveNote(week, note) {
                try {
                    setSaving(true);
                    // Find if note exists
                    const notes = await api.read('week_notes!A2:B');
                    const existingRow = notes.findIndex(row => row[0] === week.toString());
                    
                    if (existingRow >= 0) {
                        // Update existing (row number = existingRow + 2 for header + 0-indexing)
                        await api.update(`week_notes!B${existingRow + 2}`, [[note]]);
                    } else {
                        // Append new
                        await api.append('week_notes!A:B', [[week, note]]);
                    }
                    
                    setWeekNotes(prev => ({ ...prev, [week]: note }));
                    setLastSync(new Date());
                } catch (error) {
                    alert('Failed to save note.');
                } finally {
                    setSaving(false);
                }
            }

            // ============= UI HELPERS =============
            const getTodayDate = () => new Date().toISOString().split('T')[0];

            const getRecentDailyWeights = () => {
                return Object.entries(dailyWeights)
                    .sort((a, b) => new Date(b[0]) - new Date(a[0]))
                    .slice(0, 14);
            };

            const getWeeklyAverage = () => {
                const recent = getRecentDailyWeights().slice(0, 7);
                if (recent.length === 0) return null;
                const sum = recent.reduce((acc, [_, weight]) => acc + weight, 0);
                return (sum / recent.length).toFixed(1);
            };

            const getWeekCompletion = (week) => {
                const weekWorkouts = Object.keys(completedWorkouts).filter(key => 
                    key.startsWith(`w${week}-`)
                );
                const completed = weekWorkouts.filter(key => completedWorkouts[key]).length;
                return weekWorkouts.length > 0 ? Math.round((completed / weekWorkouts.length) * 100) : 0;
            };

            const toggleWeek = (phaseId, week) => {
                const key = `${phaseId}-${week}`;
                setExpandedWeek(prev => ({ ...prev, [key]: !prev[key] }));
            };

            const toggleDay = (week, dayId) => {
                const key = `${week}-${dayId}`;
                setExpandedDay(prev => ({ ...prev, [key]: !prev[key] }));
            };

            const goToWeek = (week) => {
                setCurrentWeek(week);
                const phase = week <= 6 ? 1 : week <= 14 ? 2 : 3;
                setExpandedPhase(phase);
                setExpandedWeek({ [`${phase}-${week}`]: true });
            };

            // ============= WORKOUT DATA =============
            const phases = [
                {
                    id: 1,
                    name: "Phase 1: Foundation (Weeks 1-6)",
                    weeks: [1, 2, 3, 4, 5, 6],
                    schedule: [
                        {
                            id: 1,
                            day: "Monday - Strength A",
                            exercises: [
                                { name: "Goblet Squats (2x8)" },
                                { name: "Dumbbell Rows (2x10 each arm)" },
                                { name: "Dumbbell Floor Press (2x10)" },
                                { name: "Plank (2x15-20s)" },
                            ]
                        },
                        {
                            id: 2,
                            day: "Tuesday - Cardio",
                            exercises: [
                                { name: "Walk (10-14k steps)" },
                                { name: "Optional: Assault Bike (10 min)" },
                            ]
                        },
                        // Add more days...
                    ]
                },
                // Add Phase 2 and 3 with similar structure...
            ];

            // ============= RENDER =============
            if (loading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-green-50 flex items-center justify-center">
                        <div className="text-gray-600">Loading from Google Sheets...</div>
                    </div>
                );
            }

            const startWeight = 178;
            const goalWeight = 170;
            const latestWeight = weightLog[currentWeek] || startWeight;
            const weightLost = startWeight - latestWeight;
            const progressPercent = Math.min(100, ((startWeight - latestWeight) / (startWeight - goalWeight)) * 100);

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-green-50 p-4">
                    <div className="max-w-6xl mx-auto">
                        {/* Header */}
                        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <div className="flex justify-between items-center mb-4">
                                <h1 className="text-3xl font-bold text-gray-800">6-Month Transformation</h1>
                                <div className="text-right text-sm">
                                    {saving ? (
                                        <span className="text-yellow-600">‚è≥ Saving...</span>
                                    ) : lastSync ? (
                                        <span className="text-green-600">‚úì Synced {lastSync.toLocaleTimeString()}</span>
                                    ) : null}
                                    <button onClick={loadData} className="block text-blue-600 hover:text-blue-700">
                                        üîÑ Refresh
                                    </button>
                                </div>
                            </div>

                            {/* Progress Cards */}
                            <div className="grid md:grid-cols-4 gap-4 mb-4">
                                <div className="bg-blue-50 p-4 rounded-lg">
                                    <div className="text-sm text-gray-600">Current Week</div>
                                    <div className="text-2xl font-bold text-blue-600">Week {currentWeek}/24</div>
                                </div>
                                <div className="bg-green-50 p-4 rounded-lg">
                                    <div className="text-sm text-gray-600">Current Weight</div>
                                    <div className="text-2xl font-bold text-green-600">{latestWeight} lbs</div>
                                </div>
                                <div className="bg-purple-50 p-4 rounded-lg">
                                    <div className="text-sm text-gray-600">Weight Lost</div>
                                    <div className="text-2xl font-bold text-purple-600">{weightLost.toFixed(1)} lbs</div>
                                </div>
                                <div className="bg-yellow-50 p-4 rounded-lg">
                                    <div className="text-sm text-gray-600">To Goal</div>
                                    <div className="text-2xl font-bold text-yellow-600">{(latestWeight - goalWeight).toFixed(1)} lbs</div>
                                </div>
                            </div>

                            {/* Progress Bar */}
                            <div className="mb-4">
                                <div className="flex justify-between text-sm text-gray-600 mb-1">
                                    <span>Progress to Goal</span>
                                    <span>{progressPercent.toFixed(0)}%</span>
                                </div>
                                <div className="w-full bg-gray-200 rounded-full h-3">
                                    <div 
                                        className="bg-gradient-to-r from-blue-500 to-green-500 h-3 rounded-full"
                                        style={{ width: `${progressPercent}%` }}
                                    />
                                </div>
                            </div>

                            {/* Action Buttons */}
                            <div className="flex gap-2">
                                <button
                                    onClick={() => {
                                        setSelectedWeek(currentWeek);
                                        setTempWeight(weightLog[currentWeek] || '');
                                        setShowWeightModal(true);
                                    }}
                                    className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
                                >
                                    Log Weight
                                </button>
                                {currentWeek < 24 && (
                                    <button
                                        onClick={() => goToWeek(currentWeek + 1)}
                                        className="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600"
                                    >
                                        Next Week
                                    </button>
                                )}
                            </div>
                        </div>

                        {/* Daily Weight Tracker */}
                        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <h2 className="text-xl font-bold mb-4">üìä Daily Weight</h2>
                            <div className="flex gap-2">
                                <input
                                    type="number"
                                    step="0.1"
                                    value={todayWeight}
                                    onChange={(e) => setTodayWeight(e.target.value)}
                                    placeholder="Today's weight"
                                    className="flex-1 border rounded px-3 py-2"
                                />
                                <button
                                    onClick={saveDailyWeight}
                                    className="bg-green-500 text-white px-6 py-2 rounded hover:bg-green-600"
                                >
                                    Save
                                </button>
                            </div>
                            {getWeeklyAverage() && (
                                <p className="text-sm text-gray-600 mt-2">
                                    7-day average: <span className="font-bold">{getWeeklyAverage()} lbs</span>
                                </p>
                            )}
                        </div>

                        {/* Workout Phases */}
                        {phases.map(phase => (
                            <div key={phase.id} className="bg-white rounded-lg shadow-lg mb-4">
                                <div 
                                    className="bg-gradient-to-r from-green-500 to-blue-500 text-white p-6 cursor-pointer flex justify-between"
                                    onClick={() => setExpandedPhase(expandedPhase === phase.id ? null : phase.id)}
                                >
                                    <div>
                                        <h2 className="text-2xl font-bold">{phase.name}</h2>
                                    </div>
                                    {expandedPhase === phase.id ? <ChevronUp size={24} /> : <ChevronDown size={24} />}
                                </div>

                                {expandedPhase === phase.id && (
                                    <div className="p-6">
                                        {phase.weeks.map(week => (
                                            <div key={week} className={`mb-4 border-2 rounded-lg ${week === currentWeek ? 'border-blue-500' : 'border-gray-200'}`}>
                                                <div 
                                                    className="p-4 cursor-pointer bg-gray-50"
                                                    onClick={() => toggleWeek(phase.id, week)}
                                                >
                                                    <div className="flex justify-between">
                                                        <span className="font-semibold">Week {week}</span>
                                                        {expandedWeek[`${phase.id}-${week}`] ? <ChevronUp size={20} /> : <ChevronDown size={20} />}
                                                    </div>
                                                    <div className="text-sm text-gray-600 mt-1">{getWeekCompletion(week)}% complete</div>
                                                </div>

                                                {expandedWeek[`${phase.id}-${week}`] && (
                                                    <div className="p-4">
                                                        {phase.schedule.map(day => (
                                                            <div key={day.id} className="mb-3 border rounded">
                                                                <div 
                                                                    className="bg-gray-50 p-3 cursor-pointer"
                                                                    onClick={() => toggleDay(week, day.id)}
                                                                >
                                                                    <div className="flex justify-between">
                                                                        <span className="font-semibold">{day.day}</span>
                                                                        {expandedDay[`${week}-${day.id}`] ? <ChevronUp size={18} /> : <ChevronDown size={18} />}
                                                                    </div>
                                                                </div>

                                                                {expandedDay[`${week}-${day.id}`] && (
                                                                    <div className="p-3">
                                                                        {day.exercises.map((exercise, idx) => {
                                                                            const key = `w${week}-d${day.id}-e${idx}`;
                                                                            const isCompleted = completedWorkouts[key];
                                                                            return (
                                                                                <div 
                                                                                    key={idx}
                                                                                    className={`flex items-center p-2 rounded cursor-pointer ${isCompleted ? 'bg-green-50' : 'bg-gray-50'}`}
                                                                                    onClick={() => toggleWorkout(week, day.id, idx)}
                                                                                >
                                                                                    <div className={`w-5 h-5 rounded border-2 flex items-center justify-center mr-2 ${isCompleted ? 'bg-green-500 border-green-500' : 'border-gray-300'}`}>
                                                                                        {isCompleted && <Check size={14} className="text-white" />}
                                                                                    </div>
                                                                                    <span className="text-sm">{exercise.name}</span>
                                                                                </div>
                                                                            );
                                                                        })}
                                                                    </div>
                                                                )}
                                                            </div>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        ))}

                        {/* Weight Modal */}
                        {showWeightModal && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                                <div className="bg-white rounded-lg p-6 max-w-md w-full mx-4">
                                    <h3 className="text-xl font-bold mb-4">Log Weight - Week {selectedWeek}</h3>
                                    <input
                                        type="number"
                                        step="0.1"
                                        value={tempWeight}
                                        onChange={(e) => setTempWeight(e.target.value)}
                                        placeholder="Weight in lbs"
                                        className="w-full border rounded px-3 py-2 mb-4"
                                    />
                                    <div className="flex gap-2">
                                        <button
                                            onClick={saveWeightForWeek}
                                            className="flex-1 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
                                        >
                                            Save
                                        </button>
                                        <button
                                            onClick={() => setShowWeightModal(false)}
                                            className="flex-1 bg-gray-300 px-4 py-2 rounded hover:bg-gray-400"
                                        >
                                            Cancel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ExerciseTracker />);
    </script>
</body>
</html>
